<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>HW2 Q5-LU KAI</title>
        <link rel="stylesheet" href="/lib/d3/d3.slider.css" />
        <script type="text/javascript" src="/lib/d3/d3.v3.min.js"></script>
        <script src="../lib/d3/d3.tip.v0.6.3.js"></script>
        <script src="../lib/d3/d3.slider.js"></script>
        <style type="text/css">
            div.bar{
                display: inline-block;
                width: 20px;
                height: 75px;
                background-color: teal;
                margin-right: 2px;
            }

            .tooltip {             
              font-weight: bold;
              line-height: 1;
              text-align: center;           
              width: 300px;                  
              padding: 5px;             
              font: 12px sans-serif;        
              background: rgba(0, 0, 0, 0.8);
              color: #fff;   
              border-radius: 8px;           
            }
            .wrapper {
              width: 1000px;
              margin-left: auto;
              margin-right: auto;
            }
            #slider1{
              width : 1000px;
            }
            .axis path,
            .axis line {
                fill: none;
                stroke: black;
                shape-rendering: crispEdges;
            }

            .axis text {
                font-family: sans-serif;
                font-size: 11px;
            }
            }
        </style>
    </head>
    <body>

        <div class="wrapper">
    
        <div id ="title"></div>
        <h2>The range of avarage net price per year: [<span id="slider1textmin">0</span>, <span id="slider1textmax">10000</span>]</h2>
        <div id ="slider1"></div>

        <div id ="slider2"></div>
        <h2>Top 10 schools with the highest ratio of Earning to Tuition:</h2>

        <div id ="svg"></div>
        </div>
        <script type="text/javascript">
            
            d3.select("#title").append('p').text("HW2 Q5-LU KAI");
            var padding = 50;
            var h = 1000
            var w = 1000
            //var formatNumber = d3.format(",.0f"),    // zero decimal places
            //format = function(d) { return formatNumber(d) + " " + units; },
            var svg=d3.select("#svg").append("svg")
                .attr({
                    height: h,
                    width: w
                })
                .append("g")
                .attr("transform", "translate(" + padding + "," + padding + ")");


            var slider1 = d3.slider()
            .min(0).max(100000).step(10000)
            .axis(true).value([0,10000])
            .on("slide",function(evt,value){
                svg.selectAll("*").remove();
                d3.select('#slider1textmin').text(value[ 0 ]);
                d3.select('#slider1textmax').text(value[ 1 ]);
                getSchool(value[0],value[1]);
            });
            getSchool(0,10000);
            d3.select("#slider1")
            .call(slider1);

            function getSchool(low,high){
              d3.csv("Most+Recent+Cohorts+(Scorecard+Elements).csv",function(error,data){
                      var dataset=[]
                  data.forEach(function(d){

                      var price = 0
                      var type = ""
                      var earn = 0
                      if (d["md_earn_wne_p10"]!="NULL"){earn = +d["md_earn_wne_p10"]}
                      if (d["NPT4_PUB"]!="NULL"){price = + d["NPT4_PUB"];type = "Public";}
                      if (d["NPT4_PRIV"]!="NULL"){price = + d["NPT4_PRIV"];type = "Private";}
                      if ((price>low)&&(price<=high)&&(earn>0)){
                        var score = earn/price
                        dataset.push({
                          name: d.INSTNM,
                          city: d.CITY,
                          state: d.STABBR,
                          price: price,
                          type:type,
                          earn: earn,
                          score: score,
                          url: d.INSTURL
                      });
                    }
                  });
                colorscale = d3.scale.category20()
                            .domain(["Public","Private"]);
                            //.range(["red","blue"]);
                dataset.sort(function(a,b){return b.score-a.score})
                var topTen = []
                
                var tip = d3.tip()
                .attr('class', 'tooltip')
                .offset([0,0])
                .html(function(d){
                    return `Location: ${d.city},${d.state}
                    Tuition: ${d.price} Earning: ${d.earn} 
                    URL: ${d.url} 
                    Score: ${d.score}`  //here is a ECMAScript 6 new feature
                });

                svg.call(tip);

                for(i=0;i<10;i++){topTen.push(dataset[i]);};

                var scaley = d3.scale.ordinal()
                            .domain(topTen.map(function(d) { return d.name; }))
                            .rangeRoundBands([0+padding+10,h-padding],.2);
                var scalex = d3.scale.linear()
                            .domain([0,topTen[0].score])
                            .range([250,w-padding]);
                svg.selectAll("rect")
                .data(topTen)
                .enter()
                .append("rect")
                .attr('y', function(d){return scaley(d.name)})
                .attr('height', scaley.rangeBand())
                .attr("x", 250)
                .attr("width", function(d){
                    //console.log(d.score)
                    return scalex(d.score)-250;
                })
                .attr('fill',function(d){
                    return colorscale(d.type);
                })
                .on("mouseover", tip.show)
                .on("mouseout", tip.hide);

                var axisx = d3.svg.axis()
                                .scale(scalex)
                                .orient("top");
                var axisy = d3.svg.axis()
                                .scale(scaley)
                                .orient("left");
                svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(0," +  55+ ")")
                .call(axisx)
                .append("text")
                .attr("transform", "rotate(0)")
                .attr("x", w/2+10)
                .attr('y', -35)
                .attr("dy", ".71em")
                .style("text-anchor", "middle")
                .text("Score(Proportional To Earning/Tuition)");

                svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(" +250+",0)")
                .call(axisy)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("x", -h/2)
                .attr("y", -250)
                .attr("dy", ".71em")
                .style("text-anchor", "middle")
                .text("Institution");

                //console.log(colorscale.domain())
                var legend = svg.selectAll(".legend")
                .data(colorscale.domain())
                .enter().append("g")
                .attr("class", "legend")
                .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

                legend.append("rect")
                .attr("x", w -padding- 18)
                .attr("width", 18)
                .attr("height", 18)
                .style("fill", colorscale);

                legend.append("text")
                .attr("x", w -padding- 24)
                .attr("y", 9)
                .attr("dy", ".35em")
                .style("text-anchor", "end")
                .text(function(d) { return d; });
}
        )} 
        </script>
    </body>
</html>